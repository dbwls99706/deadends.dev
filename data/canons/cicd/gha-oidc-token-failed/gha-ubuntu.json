{
  "schema_version": "1.0.0",
  "id": "cicd/gha-oidc-token-failed/gha-ubuntu",
  "url": "https://deadends.dev/cicd/gha-oidc-token-failed/gha-ubuntu",
  "error": {
    "signature": "Error: Unable to get ACTIONS_ID_TOKEN_REQUEST_URL env variable",
    "regex": "(?:Unable to get ACTIONS_ID_TOKEN_REQUEST_URL|ACTIONS_ID_TOKEN_REQUEST_URL.*not set|id-token.*permission.*not.*set|OIDC.*token.*request.*failed|Unable to get ACTIONS_ID_TOKEN_REQUEST_TOKEN)",
    "domain": "cicd",
    "category": "authentication",
    "first_seen": "2023-01-01",
    "last_confirmed": "2026-02-13"
  },
  "environment": {
    "runtime": {"name": "github-actions", "version_range": ">=2.0"},
    "os": "ubuntu-latest"
  },
  "verdict": {
    "resolvable": "true",
    "fix_success_rate": 0.92,
    "confidence": 0.93,
    "last_updated": "2026-02-13",
    "summary": "GitHub Actions OIDC token request fails because the workflow or job does not have 'permissions: id-token: write' set. The ACTIONS_ID_TOKEN_REQUEST_URL and ACTIONS_ID_TOKEN_REQUEST_TOKEN environment variables are only injected when this permission is explicitly granted. This commonly occurs when configuring keyless authentication to AWS, GCP, or Azure."
  },
  "dead_ends": [
    {
      "action": "Set the ACTIONS_ID_TOKEN_REQUEST_URL environment variable manually",
      "why_fails": "The OIDC token endpoint URL is dynamically generated by the GitHub Actions runner and includes a unique per-job authentication token. There is no static URL to set; the variable is only populated when the id-token permission is granted.",
      "fail_rate": 0.99,
      "sources": [],
      "condition": ""
    },
    {
      "action": "Use a personal access token (PAT) as a substitute for OIDC authentication",
      "why_fails": "PATs are long-lived static credentials that must be stored as secrets, rotated manually, and pose a security risk if leaked. This defeats the entire purpose of OIDC, which provides short-lived, keyless authentication. Many organizations block this approach via policy.",
      "fail_rate": 0.40,
      "sources": [],
      "condition": ""
    },
    {
      "action": "Add id-token permission at the step level instead of the job or workflow level",
      "why_fails": "GitHub Actions does not support permissions at the step level. Permissions can only be defined at the top-level 'permissions' key (workflow-wide) or within a specific 'jobs.<job_id>.permissions' block. Step-level permissions are silently ignored.",
      "fail_rate": 0.99,
      "sources": [],
      "condition": ""
    }
  ],
  "workarounds": [
    {
      "action": "Add 'permissions: id-token: write' to the job that requests the OIDC token",
      "success_rate": 0.95,
      "how": "In the workflow YAML, add a 'permissions' block at the job level: 'jobs: deploy: permissions: id-token: write contents: read'. Note that when you specify any permissions, all other permissions default to 'none', so you must explicitly include all required permissions (e.g., contents: read for checkout).",
      "sources": [],
      "condition": ""
    },
    {
      "action": "Add 'permissions: id-token: write' at the workflow level with all other needed permissions",
      "success_rate": 0.93,
      "how": "Add a top-level 'permissions' block: 'permissions: id-token: write contents: read packages: read'. This applies to all jobs in the workflow. Remember that setting workflow-level permissions overrides the default token permissions entirely, so list every permission you need.",
      "sources": [],
      "condition": "When multiple jobs in the workflow need OIDC tokens"
    },
    {
      "action": "Verify the cloud provider trust policy matches the workflow's OIDC claims",
      "success_rate": 0.88,
      "how": "After fixing the id-token permission, ensure the cloud provider's trust policy (AWS IAM role trust policy, GCP Workload Identity pool, or Azure federated credential) correctly matches the GitHub OIDC token claims: repository, ref, environment, and job_workflow_ref. Mismatched claims cause authentication to fail after token issuance.",
      "sources": [],
      "condition": "When the token is generated but cloud provider authentication still fails"
    }
  ],
  "transition_graph": {
    "leads_to": [
      {"error_id": "cicd/gha-permission-denied/gha-linux", "probability": 0.20, "condition": "When adding id-token: write but forgetting to re-add other permissions like contents: read causes checkout and other operations to fail"},
      {"error_id": "cicd/gha-checkout-failed/gha-linux", "probability": 0.15, "condition": "When specifying permissions block causes contents permission to drop to 'none', breaking actions/checkout"}
    ],
    "preceded_by": [
      {"error_id": "cicd/gha-secret-not-found/gha-linux", "probability": 0.20, "condition": "When migrating from static AWS/GCP credentials stored as secrets to OIDC-based keyless auth"}
    ],
    "frequently_confused_with": [
      {"error_id": "cicd/gha-permission-denied/gha-linux", "distinction": "OIDC token error is specifically about the id-token permission needed for federated cloud authentication; permission denied is about GITHUB_TOKEN scopes for GitHub API operations"},
      {"error_id": "cicd/gha-secret-not-found/gha-linux", "distinction": "OIDC token error means the keyless authentication flow is misconfigured; secret not found means a traditional credential stored as a repository secret is missing"}
    ]
  },
  "metadata": {
    "generated_by": "bulk_generate.py",
    "generation_date": "2026-02-13",
    "review_status": "auto_generated",
    "evidence_count": 80,
    "last_verification": "2026-02-13"
  }
}
