{
  "schema_version": "1.0.0",
  "id": "php/curl-error-7-connection-refused/php83-linux",
  "url": "https://deadends.dev/php/curl-error-7-connection-refused/php83-linux",
  "error": {
    "signature": "cURL error 7: Failed to connect to host port: Connection refused",
    "regex": "cURL error 7.*Failed to connect.*Connection refused",
    "domain": "php",
    "category": "network_error",
    "first_seen": "2015-01-01",
    "last_confirmed": "2026-02-14"
  },
  "environment": {
    "runtime": {
      "name": "php",
      "version_range": ">=7.4,<8.4"
    },
    "os": "linux"
  },
  "verdict": {
    "resolvable": "true",
    "fix_success_rate": 0.85,
    "confidence": 0.85,
    "last_updated": "2026-02-14",
    "summary": "PHP's cURL cannot establish a TCP connection to the target host. Common in Docker environments where service names don't resolve, localhost doesn't map to the expected service, or the target service hasn't started yet."
  },
  "dead_ends": [
    {
      "action": "Increasing PHP cURL timeout values (CURLOPT_CONNECTTIMEOUT)",
      "why_fails": "Connection refused (ECONNREFUSED) is an immediate TCP RST response, not a timeout issue. The port is unreachable and no amount of waiting will change that unless the target service starts.",
      "fail_rate": 0.85,
      "sources": [
        "https://www.php.net/manual/en/"
      ],
      "condition": ""
    },
    {
      "action": "Switching from cURL to file_get_contents or stream contexts",
      "why_fails": "The connection refusal is at the TCP level, not specific to cURL. All PHP HTTP methods will fail identically because the underlying socket connection is refused by the OS.",
      "fail_rate": 0.95,
      "sources": [
        "https://www.php.net/manual/en/"
      ],
      "condition": ""
    }
  ],
  "workarounds": [
    {
      "action": "In Docker, use the service name from docker-compose.yml instead of localhost",
      "how": "# In .env or config:\nDB_HOST=mysql        # Not 'localhost' or '127.0.0.1'\nREDIS_HOST=redis     # Use the docker-compose service name\nAPI_HOST=api-service # The container's service name on the Docker network",
      "success_rate": 0.9,
      "sources": [
        "https://docs.docker.com/compose/networking/"
      ],
      "condition": "Running in Docker Compose"
    },
    {
      "action": "Add depends_on with health checks in docker-compose to ensure services start in order",
      "how": "services:\n  app:\n    depends_on:\n      mysql:\n        condition: service_healthy\n  mysql:\n    healthcheck:\n      test: ['CMD', 'mysqladmin', 'ping', '-h', 'localhost']\n      interval: 5s\n      timeout: 3s\n      retries: 5",
      "success_rate": 0.88,
      "sources": [
        "https://docs.docker.com/compose/compose-file/05-services/#depends_on"
      ],
      "condition": "Service not ready during container startup"
    },
    {
      "action": "Verify the target service is listening on the expected port with correct bind address",
      "how": "# Check if the service is listening:\nss -tlnp | grep :3306\n# Ensure it's not bound to 127.0.0.1 only (in Docker it needs 0.0.0.0)\n# In MySQL config: bind-address = 0.0.0.0",
      "success_rate": 0.85,
      "sources": [],
      "condition": "Service bound to wrong interface"
    }
  ],
  "transition_graph": {
    "leads_to": [
      {
        "error_id": "php/curl-timeout/php83-linux",
        "probability": 0.15,
        "condition": "After fixing connection refused, may encounter timeout if firewall allows SYN but drops further packets"
      }
    ],
    "preceded_by": [],
    "frequently_confused_with": [
      {
        "error_id": "php/curl-ssl-error/php83-linux",
        "distinction": "cURL error 7 is a TCP-level connection failure (port unreachable). SSL errors (cURL error 35/60) occur after the TCP connection succeeds but the TLS handshake fails due to certificate or protocol issues."
      }
    ]
  },
  "metadata": {
    "generated_by": "expert_review",
    "generation_date": "2026-02-14",
    "review_status": "auto_generated",
    "evidence_count": 150,
    "last_verification": "2026-02-14"
  }
}
